var t,e;function n(t,e){}function i(t){}function s(t){}function a(){}function o(){}(function(){var n=window.eval,i=function(t,e,n){var i=n||{};if(e){var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.prototype.superClass=e.prototype,s=null}for(var a in i)t.prototype[a]=i[a];return i=null,t};window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout,String||(String={}),String.format||(String.format=function(){if(0==arguments.length)return null;for(var t,e=arguments[0]||"",n=1,i=arguments.length;n<i;n++)t=new RegExp("\\{"+(n-1)+"\\}","gm"),e=e.replace(t,arguments[n]);return t=null,e}),String.getByteLength||(String.getByteLength=function(t){var e,n=0,i=t||"",s=i.length;for(e=0;e<s;e++)i.charCodeAt(e)>=0&i.charCodeAt(e)<=255?n+=1:n+=2;return e=i=s=null,n}),Array&&Array.prototype||(Array.prototype={}),Array.prototype.indexOfAttr=function(t,e){for(var n=(typeof t).toLowerCase(),i=-1,s=0,a=this.length;s<a;s++)if("string"==n&&this[s][t]==e||"number"==n&&this[s]==t){i=s;break}return n=null,i};var s,a,o,r,h,l,u,c,d,f,m={canvas:{id:"linkScreen",defaultId:"linkScreen",defaultFont:"12px Arial",defaultWidth:240,defaultHeight:320,defaultColor:"rgb(0, 0, 0)",bgColor:"#000",cavansDoms:[],ctxs:[],device:"",fps:1,touch:!1,zoom:1},system:{loadRes:null,pageLoad:null,menu:null,run:null,runFn:function(){},rafRun:null,stop:null,over:null,zone:null,active:null,lastDate:Date.now(),timeout:30,isPause:!1,gameFlow:-1,loadedImageToGameFlow:-1,zoneArgs:null,activeArgs:null,spendTime:0,loadResTimer:null,playTimer:null},event:{key:0,keys:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},lastKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},pressedKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},keyPressCtrl:{up:!0,down:!0,left:!0,right:!0,a:!0,b:!0,c:!0,menu:!0,quit:!0},keyDownGo:!1,keyUpGo:!1,keyPressedGo:!1,keyDownCallBack:null,keyUpCallBack:null,orientationChange:null,touchStart:null,touchEnd:null,touchMove:null,touchCancel:null,clickCallBack:null,mouseDownCallBack:null,mouseUpCallBack:null,mouseMoveCallBack:null,focused:!1,pageFocusCallBack:null,pageUnFocusCallBack:null,swipeCallBack:null,pageOffX:0,pageOffY:0,pageStarOffX:0,pageStarOffY:0,swipeDate:null,swipeTimeout:200,swipeRange:50},image:{imgs:{},imgObjs:[],initImgs:{},asyncImgObjs:{},imgCount:0,countLoaded:0,version:"",inited:!1},audio:{audios:{}},ajax:{xhrObj:null,pool:[],poolLength:5,date:null,isTimeout:!1,param:{type:"get",data:null,dataType:"json",url:"",xhr:null,timeout:5e3,before:function(t){},success:function(t,e){},error:function(t,e){},complete:function(t){}}},request:{gets:[]},buttonLayout:{buttons:[],Button:i((function(t){this.id=t.id,this.value=t.value,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.bgColor=t.bgColor,this.bgStroke=t.bgStroke,this.stroke=t.stroke,this.font=t.font,this.imageId=t.imageId,this.sx=t.sx,this.sy=t.sy,this.color=t.color,this.hx=t.hx,this.hy=t.hy,this.hColor=t.hColor,this.dex=t.dex,this.dey=t.dey,this.deColor=t.deColor,this.hided=t.hided,this.disabled=t.disabled,this.path=t.path,this.hovered=!1,this.repeated=!1,this.pressed=!1,this.released=!1,this.goned=!1,this.cacheId="buttonLayoutCache_"+this.id,this.setDelay(t.delay).refresh()}),null,{refresh:function(){if(v.canvas.pass(this.cacheId,3*this.width,this.height),""==this.imageId?(""!=this.bgColor&&v.canvas.fillStyle(this.bgColor).fillRect(0,0,this.width,this.height).fillRect(this.width,0,this.width,this.height).fillRect(2*this.width,0,this.width,this.height),""!=this.bgStroke&&v.canvas.strokeStyle(this.bgStroke).strokeRect(1,1,this.width-2,this.height-2).strokeRect(this.width+1,1,this.width-2,this.height-2).strokeRect(2*this.width+1,1,this.width-2,this.height-2)):v.canvas.drawImage(this.imageId,this.sx,this.sy,this.width,this.height,0,0,this.width,this.height).drawImage(this.imageId,this.hx,this.hy,this.width,this.height,this.width,0,this.width,this.height).drawImage(this.imageId,this.dex,this.dey,2*this.width,this.height,2*this.width,0,this.width,this.height),""!=this.value){var t=v.canvas.font(this.font).measureText(this.value),e=this.width-t.width>>1,n=(this.height-t.height>>1)+parseInt(this.font)-2;""!=this.stroke&&v.canvas.fillStyle(this.stroke).fillText(this.value,e-1,n).fillText(this.value,e,n-1).fillText(this.value,e+1,n).fillText(this.value,e,n+1).fillText(this.value,e+this.width-1,n).fillText(this.value,e+this.width,n-1).fillText(this.value,e+this.width+1,n).fillText(this.value,e+this.width,n+1).fillText(this.value,e+2*this.width-1,n).fillText(this.value,e+2*this.width,n-1).fillText(this.value,e+2*this.width+1,n).fillText(this.value,e+2*this.width,n+1),v.canvas.fillStyle(this.color).fillText(this.value,e,n).fillStyle(this.hColor).fillText(this.value,e+this.width,n).fillStyle(this.deColor).fillText(this.value,e+2*this.width,n),t=e=n=null}return v.canvas.pass(),this},show:function(){return this.hided=!1,this},hide:function(){return this.hided=!0,this},disable:function(t){return this.disabled=t,this},setPath:function(t,e){return this.setDelay(e).path=t||[],this},endPath:function(){return 0==this.path.length},gone:function(t,e){return this.setPath(t,e).goned=!0,this},setDelay:function(t){return this.delay=t||0,this.delayDate=null,this.delay>0&&(this.delayDate=Date.now()),this},action:function(){if(this.hided)return this;if(this.delayDate&&Date.now()-this.delayDate>=this.delay&&(this.delayDate=null),!this.delayDate&&this.path.length>0){var t=this.path.shift();this.x+=t[0],this.y+=t[1],t=null}return this},render:function(){return this.hided||v.canvas.drawCache(this.cacheId,this.hovered?this.width:this.disabled?2*this.width:0,0,this.width,this.height,this.x,this.y,this.width,this.height),this},disposed:function(){return this}})}},p={canvas:{context:{base:0},graphics:{HCENTER:1,VCENTER:2,LEFT:4,RIGHT:8,TOP:16,BOTTOM:32,ANCHOR_LT:20,ANCHOR_LV:6,ANCHOR_LB:36,ANCHOR_HT:17,ANCHOR_HV:3,ANCHOR_HB:33,ANCHOR_RT:24,ANCHOR_RV:10,ANCHOR_RB:40},trans:{TRANS_MIRROR:2,TRANS_NONE:0,TRANS_ROT90:5,TRANS_ROT180:3,TRANS_ROT270:6,TRANS_MIRROR_ROT90:7,TRANS_MIRROR_ROT180:1,TRANS_MIRROR_ROT270:4}},event:{key:{up:38,down:40,left:37,right:39,a:90,b:88,c:67,menu:49,quit:50}},system:{gameFlowType:{menu:0,run:1,stop:2,over:3,zone:4,active:5,loadImage:6,loadedImage:7}}},g={getCanvasDom:function(){var t;return function(){return t||(t=v.getDom(m.canvas.defaultId)),t}}(),getOffsetX:function(t){return t.offsetX||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].clientX-g.getCanvasDom().offsetLeft:t.clientX-g.getCanvasDom().offsetLeft)||0},getOffsetY:function(t){return t.offsetY||(t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].clientY-g.getCanvasDom().offsetTop:t.clientY-g.getCanvasDom().offsetTop)||0},keydown:function(t){var e=g.checkKey(t.keyCode);m.event.keyDownGo&&null!=m.event.keys[e]&&(m.event.keys[e]=!0),m.event.keyUpGo&&null!=m.event.lastKey[e]&&(m.event.lastKey[e]=!1),m.event.keyPressCtrl[e]&&m.event.keyPressedGo&&(null!=m.event.pressedKey[e]&&(m.event.pressedKey[e]=!0),m.event.keyPressCtrl[e]=!1),null!=m.event.keyDownCallBack&&m.event.keyDownCallBack(t),e=null},keyup:function(t){var e=g.checkKey(t.keyCode);m.event.keyDownGo&&null!=m.event.keys[e]&&(m.event.keys[e]=!1),m.event.keyUpGo&&null!=m.event.lastKey[e]&&(m.event.lastKey[e]=!0),m.event.keyPressedGo&&(null!=m.event.pressedKey[e]&&(m.event.pressedKey[e]=!1),m.event.keyPressCtrl[e]=!0),null!=m.event.keyUpCallBack&&m.event.keyUpCallBack(t),e=null},orientationchange:function(t){null!=m.event.orientationChange&&m.event.orientationChange(t)},swipeStart:function(t,e){null!=m.event.swipeCallBack&&(m.event.swipeDate=Date.now(),m.event.pageStarOffX=t,m.event.pageStarOffY=e)},swipeSuccess:function(t,e){if(m.event.swipeDate){if(Date.now()-m.event.swipeDate<m.event.swipeTimeout&&(Math.abs(t-m.event.pageStarOffX)>=m.event.swipeRange||Math.abs(e-m.event.pageStarOffY)>=m.event.swipeRange))return m.event.swipeCallBack(m.event.pageStarOffX,m.event.pageStarOffY,t,e),!0;m.event.swipeDate=null}return!1},touchstart:function(t){if(t.preventDefault(),m.event.pageOffX=g.getOffsetX(t),m.event.pageOffY=g.getOffsetY(t),null!=m.event.touchStart&&m.event.touchStart(t,m.event.pageOffX,m.event.pageOffY),g.buttonLayoutEventHandler(t.type,m.event.pageOffX,m.event.pageOffY))return!1;g.swipeStart(m.event.pageOffX,m.event.pageOffY)},touchend:function(t){return t.preventDefault(),!g.swipeSuccess(m.event.pageOffX,m.event.pageOffY)&&(!g.buttonLayoutEventHandler(t.type,m.event.pageOffX,m.event.pageOffY)&&void(null!=m.event.touchEnd&&m.event.touchEnd(t,m.event.pageOffX,m.event.pageOffY)))},touchmove:function(t){t.preventDefault(),m.event.pageOffX=g.getOffsetX(t),m.event.pageOffY=g.getOffsetY(t),null!=m.event.touchMove&&m.event.touchMove(t,m.event.pageOffX,m.event.pageOffY)},touchcancel:function(t){m.event.pageOffX=g.getOffsetX(t),m.event.pageOffY=g.getOffsetY(t),null!=m.event.touchCancel&&m.event.touchCancel(t,m.event.pageOffX,m.event.pageOffY)},click:function(t){null!=m.event.clickCallBack&&m.event.clickCallBack(t,g.getOffsetX(t),g.getOffsetY(t))},mouseDown:function(t){var e=g.getOffsetX(t),n=g.getOffsetY(t);if(g.buttonLayoutEventHandler(t.type,e,n))return!1;null!=m.event.mouseDownCallBack&&m.event.mouseDownCallBack(t,e,n),g.swipeStart(e,n),e=n=null},mouseUp:function(t){var e=g.getOffsetX(t),n=g.getOffsetY(t);return!g.buttonLayoutEventHandler(t.type,e,n)&&(!g.swipeSuccess(e,n)&&(null!=m.event.mouseUpCallBack&&m.event.mouseUpCallBack(t,e,n),void(e=n=null)))},mouseMove:function(t){null!=m.event.mouseMoveCallBack&&m.event.mouseMoveCallBack(t,g.getOffsetX(t),g.getOffsetY(t))},pageFocus:function(t){if(m.event.focused)return m.event.focused=!1,!1;null!=m.event.pageFocusCallBack&&m.event.pageFocusCallBack(t)},pageUnFocus:function(t){null!=m.event.pageUnFocusCallBack&&m.event.pageUnFocusCallBack(t)},checkKey:function(t){var e="0";for(var n in p.event.key)if(p.event.key[n]==t){e=n;break}return e},getDeviceConfig:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("duopaosafari")?{device:"duopaoSafari",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("iphone")||-1!=t.indexOf("ipod")?{device:"iphone",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("ipad")?{device:"ipad",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("duopaoandroid")?{device:"duopaoAndroid",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("duopaowindowsphone")?{device:"duopaoWindowsPhone",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("opera mobi")?{device:"operamobile",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("flyflow")?{device:"flyflow",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("android")?{device:"android",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("iemobile")?{device:"iemobile",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("j2me")?{device:"j2me",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("symbian v5")?{device:"symbian5",fps:1,touch:!0,zoom:1}:-1!=t.indexOf("symbian v3")?{device:"symbian3",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("chrome")?{device:"chrome",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("firefox")?{device:"firefox",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("msie")||-1!=t.indexOf("windows")?{device:"ie",fps:.5,touch:!1,zoom:1}:-1!=t.indexOf("safari")?{device:"safari",fps:1,touch:!1,zoom:1}:-1!=t.indexOf("opera")?{device:"opera",fps:1,touch:!1,zoom:1}:{device:"",fps:1,touch:!1,zoom:1}},setImage:function(t,e,n,i,s){if(!t||!e)return!1;m.image.imgs[t]||(m.image.imgs[t]=new Image,m.image.imgs[t].onload=function(){m.image.countLoaded++,this.loaded=!0,this.cache&&v.canvas.pass(this.id,this.width,this.height).drawImage(this.id,0,0).pass().base().delImage(this.id,!0)},m.image.imgs[t].src=e+(""!=m.image.version?"?v="+m.image.version:""),m.image.imgs[t].id=t,m.image.imgs[t].url=e,m.image.imgs[t].benchId=n,m.image.imgs[t].bench=i,m.image.imgs[t].cache=s,m.image.imgs[t].refreshed=!1)},setAudio:function(t,e,n,i,s,a){if(!t||!e)return!1;if(!m.audio.audios[t]){var o=new Audio(e+(""!=m.image.version?"?v="+m.image.version:""));o.id=t,o.autoplay=i,o.preload=s,o.autobuffer=a,o.loop=n,m.audio.audios[o.id]=o,o=null}},loadingCallBack:function(t,e,n){var i=v.canvas.screen.getWidth(),s=v.canvas.screen.getHeight(),a=i,o=5,r=parseInt(i-a>>1),h=s-o,l=(t=t>e?e:t,parseInt(t/e*100)+"%");v.canvas.fillStyle(m.canvas.bgColor).fillRect(0,0,i,s).fillStyle("#00FFFF").fillRect(r,h,parseInt(t/e*a),o).fillStyle("#FFF").fillText("loading "+n,5,s-10).fillText(l,i-v.canvas.measureText(l).width-5,s-10),i=s=a=o=r=h=l=null},loadingEndCallBack:null,getAnchor:function(t,e,n,i,s){var a=t,o=e;switch(s){case p.canvas.graphics.ANCHOR_HV:a-=parseInt(n/2),o-=parseInt(i/2);break;case p.canvas.graphics.ANCHOR_LV:o-=parseInt(i/2);break;case p.canvas.graphics.ANCHOR_RV:a-=n,o-=parseInt(i/2);break;case p.canvas.graphics.ANCHOR_HT:a-=parseInt(n/2);break;case 0:case p.canvas.graphics.ANCHOR_LT:default:break;case p.canvas.graphics.ANCHOR_RT:a-=n;break;case p.canvas.graphics.ANCHOR_HB:a-=parseInt(n/2),o-=i;break;case p.canvas.graphics.ANCHOR_LB:o-=i;break;case p.canvas.graphics.ANCHOR_RB:a-=n,o-=i}return{x:a,y:o}},initUrlParams:function(t){if(t.indexOf("?")>=0){var e=t.split("?"),n=[];e[1].indexOf("&")>=0?n=e[1].split("&"):n.push(e[1]);for(var i=[],s=0;s<n.length;s++)n[s].indexOf("=")>=0&&(i=n[s].split("="),m.request.gets[i[0]]=i[1]);i=null,n=null,e=null}},audioEnded:function(){v.audio.replay(this.id)},pageLoaded:function(){m.image.inited=!0,m.system.pageLoad(v)},buttonLayoutAction:function(){for(var t,e=m.buttonLayout.buttons,n=e.length-1;n>=0;n--)(t=e[n])&&(t.action().render(),t.goned&&t.endPath()&&e.splice(n,1));e=t=null},buttonLayoutEventHandler:function(t,e,n){for(var i,s=m.buttonLayout.buttons,a=!1,o=s.length-1;o>=0;o--)if(i=s[o])if(v.comm.collision(i.x,i.y,i.width,i.height,e-5,n-5,10,10)){switch(t){case"mousedown":case"touchstart":i.hovered=!0,i.repeated=!0,i.pressed=!0,i.released=!1;break;case"mouseup":case"touchend":i.hovered&&(i.released=!0,i.hovered=!1),i.repeated=!1,i.pressed=!1}a=!0}else"mouseup"!=t&&"touchend"!=t||(i.hovered=!1,i.repeated=!1);return s=i=null,a}};t={init:function(t,e){return t||e?(m.canvas.defaultWidth=t,m.canvas.defaultHeight=e):(this.version=1,this.request.init(),this.canvas.initDevice(),this.localStorage.init(),this.sessionStorage.init()),this},extend:i,setAjax:function(t){return m.ajax.param=this.objExtend(m.ajax.param,t||{}),this},ajax:function(t){if(t&&m.ajax.pool.length<m.ajax.poolLength&&m.ajax.pool.push(t),t&&t.clear&&(m.ajax.pool=[]),m.ajax.xhr||(m.ajax.xhr=new XMLHttpRequest,m.ajax.xhr.onreadystatechange=function(){if(m.ajax.isTimeout)return!1;var t=m.ajax.xhr,e=m.ajax.xhrObj;if(e&&4==t.readyState){if(m.ajax.date&&(clearTimeout(m.ajax.date),m.ajax.date=null),200==t.status){var n;switch(e.dataType){case"HTML":case"SCRIPT":case"XML":n=t.responseText;break;case"TEXT":default:n=t.responseText.replace(/<[^>].*?>/g,"");break;case"JSON":n=v.getJson(t.responseText)}e.success(n,e),e.complete(e)}else e.error(e,"error");m.ajax.xhrObj=null,v.ajax()}t=e=null}),null==m.ajax.xhrObj&&m.ajax.pool.length>0){m.ajax.xhrObj=this.objExtend(m.ajax.param,m.ajax.pool.shift()||{});var e=m.ajax.xhr,n=m.ajax.xhrObj,i=m.ajax.xhrObj.url,s=null,a=n.data;if(n.type=n.type.toUpperCase(),n.dataType=n.dataType.toUpperCase(),m.ajax.isTimeout=!1,"string"==typeof a)s=a;else if("object"==typeof a){for(var o in s=[],a)s.push(o+"="+a[o]);s=s.join("&")}"GET"==n.type&&(i+="?"+s),e.open(n.type,i,!0),n.before(m.ajax.xhrObj),"POST"==n.type&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),e.send(s),e=n=s=a=i=null,m.ajax.date=setTimeout((function(){v.ajax({clear:!0}),m.ajax.isTimeout=!0,m.ajax.xhrObj&&(m.ajax.xhrObj.error(m.ajax.xhrObj,"timeout"),m.ajax.xhrObj=null)}),m.ajax.xhrObj.timeout)}return this},getDom:function(t){try{return document.getElementById(t)}catch(i){return document.all[t]}},objExtend:function(){var t,e=this.clone(arguments[0])||{},n=1,i=arguments.length,s=!1;if("boolean"==typeof e&&(s=e,e=arguments[1]||{},n=2),"object"!=typeof e&&(e={}),i==n&&(e=this,--n),!arguments[1])return e;for(;n<i;n++)if(null!=(t=arguments[n]))for(var a in t){var o=e[a],r=t[a];e!==r&&(s&&r&&"object"==typeof r&&!r.nodeType?e[a]=this.objExtend(s,o||(null!=r.length?[]:{}),r):void 0!==r&&(e[a]=r))}return e},getJson:function(t){var e={};try{e=window.JSON?JSON.parse(t):n("("+t+")")}catch(p){}return e},clone:function(){var t=arguments[0],e=t||[];if("object"==typeof e)if(null!=e.length){t=[];for(var n=0,i=e.length;n<i;n++)void 0!==e[n]&&(null!=e[n]&&"object"==typeof e[n]&&null!=e[n].length?t[n]=e[n].slice(0):t[n]=e[n])}else for(var n in t={},e)void 0!==e[n]&&(null!=e[n]&&"object"==typeof e[n]&&null!=e[n].length?t[n]=e[n].slice(0):t[n]=e[n]);return e=null,t},classes:{},comm:{registerNotify:function(t,e){null!=t&&t.register(e)},unRegisterNotify:function(t,e){null!=t&&t.unregister(e)},getRandom:function(t,e){if(!e){var n=t;return(!n||n<0)&&(n=0),Math.round(Math.random()*n)}return Math.round(Math.random()*(e-t)+t)},inArray:function(t,e){var n,i=e.length;for(n=0;n<i;n++)if(t==e[n])return n;return-1},collision:function(t,e,n,i,s,a,o,r){return!!(o&&Math.abs(t+(n>>1)-(s+(o>>1)))<n+o>>1&&Math.abs(e+(i>>1)-(a+(r>>1)))<i+r>>1)},circleCollision:function(t,e,n,i,s,a){var o=Math.abs(t-i),r=Math.abs(e-s);return Math.sqrt(o*o+r*r)<n+a},rect2CircleCollision:function(t,e,n,i,s,a,o){var r=!1;return(r=this.circleCollision(t,e,1,s,a,o))||(r=this.circleCollision(t+n,e,1,s,a,o))||(r=this.circleCollision(t+n,e+i,1,s,a,o))||(r=this.circleCollision(t,e+i,1,s,a,o))||(r=this.collision(t,e,n,i,s-(o>>1),a-(o>>1),o,o)),r},polygonCollision:function(t,e,n,i,s,a,o,r){return this.polygonSAT(t,e,n,i,s,a,o,r)&&this.polygonSAT(e,t,s,a,n,i,r,o)},setMatrixRotate:function(t,e){if(!t||!t[0])return null;for(var n,i,s=Math.PI/180*e,a=Math.sin(s),o=Math.cos(s),r=0;r<t.length;r++)n=t[r][0],i=t[r][1],t[r][0]=o*n-a*i,t[r][1]=a*n+o*i;return this},createPath:function(t,e,n,i,s){var a,o,r=[],h=t||0,l=e||0,u=n||0,c=i||0,d=u-h,f=c-l,m=Math.sqrt(Math.pow(d,2)+Math.pow(f,2)),p=s||5,g=p,v=0,y=0,R=Math.atan2(f,d)/Math.PI*180;for(R=R>=0?R:R+360,g>=m&&(g=m>>1);g<m+p;)a=(g=g>m?m:g)*Math.cos(R/180*Math.PI),o=g*Math.sin(R/180*Math.PI),r.unshift([a-v,o-y]),v=a,y=o,g+=p;return r.angle=R+90,h=l=u=c=d=f=m=p=g=R=null,r}},localStorage:function(){var t,e;return{init:function(){return t=this,e||(e=function(){var t;try{(t=window.localStorage).getItem||(t.getItem=function(){return null}),t.setItem||(t.setItem=function(){})}catch(e){t={getItem:function(){return null},setItem:function(){}}}return t}()),t},setItem:function(n,i){try{e.setItem(n,i)}catch(g){}return t},getItem:function(t){return e.getItem(t)},removeItem:function(n){return e.removeItem(n),t},clear:function(){return e.clear(),t},key:function(t){return e.key(t)},getLength:function(){return e.length},base:function(){return v}}}(),sessionStorage:function(){var t,e;return{init:function(){return t=this,e||(e=function(){var t;try{(t=window.sessionStorage).getItem||(t.getItem=function(){return null}),t.setItem||(t.setItem=function(){})}catch(e){t={getItem:function(){return null},setItem:function(){}}}return t}()),t},setItem:function(n,i){return e.setItem(n,i),t},getItem:function(t){return e.getItem(t)},removeItem:function(n){return e.removeItem(n),t},clear:function(){return e.clear(),t},key:function(t){return e.key(t)},getLength:function(){return e.length},base:function(){return v}}}(),pageLoad:function(t){return null==m.system.pageLoad&&(m.system.pageLoad=t,window.addEventListener("load",(function(){v.main(m.system.pageLoad)}),!1)),v},main:function(t){null==m.system.pageLoad&&(m.system.pageLoad=t),this.canvas.init(),this.graphics.ANCHOR_LT=p.canvas.graphics.ANCHOR_LT,this.graphics.ANCHOR_LV=p.canvas.graphics.ANCHOR_LV,this.graphics.ANCHOR_LB=p.canvas.graphics.ANCHOR_LB,this.graphics.ANCHOR_HT=p.canvas.graphics.ANCHOR_HT,this.graphics.ANCHOR_HV=p.canvas.graphics.ANCHOR_HV,this.graphics.ANCHOR_HB=p.canvas.graphics.ANCHOR_HB,this.graphics.ANCHOR_RT=p.canvas.graphics.ANCHOR_RT,this.graphics.ANCHOR_RV=p.canvas.graphics.ANCHOR_RV,this.graphics.ANCHOR_RB=p.canvas.graphics.ANCHOR_RB;var e=this.getDom(m.canvas.defaultId);e&&(this.canvas.screen.getTouch()?(window.addEventListener("orientationchange",g.orientationchange,!1),e.addEventListener("touchstart",g.touchstart,!1),e.addEventListener("touchend",g.touchend,!1),e.addEventListener("touchmove",g.touchmove,!1),e.addEventListener("touchcancel",g.touchcancel,!1)):(document.onkeydown=g.keydown,document.onkeyup=g.keyup,e.addEventListener("click",g.click,!1),e.addEventListener("mousedown",g.mouseDown,!1),e.addEventListener("mouseup",g.mouseUp,!1),e.addEventListener("mousemove",g.mouseMove,!1))),e=null;var n=this.canvas.screen.getDevice();return"ipad"==n||"iphone"==n?(m.event.focused=!0,window.addEventListener("pageshow",g.pageFocus,!1),window.addEventListener("pagehide",g.pageUnFocus,!1)):("firefox"==n&&(m.event.focused=!0),window.addEventListener("focus",g.pageFocus,!1),window.addEventListener("blur",g.pageUnFocus,!1)),this.canvas.fillStyle(m.canvas.bgColor).fillRect(0,0,this.canvas.screen.getWidth(),this.canvas.screen.getHeight()),m.image.inited=!1,this.gameFlow.run().base().play(),m.image.imgObjs.length>0?this.loadImage(m.image.imgObjs):g.pageLoaded(),this},menu:function(t){return"function"==typeof t&&(m.system.menu=t),this},run:function(t){return"function"==typeof t&&(m.system.runFn=t),this},stop:function(t){return"function"==typeof t&&(m.system.stop=t),this},over:function(t){return"function"==typeof t&&(m.system.over=t),this},zone:function(t){return"function"==typeof t&&(m.system.zone=t),this},active:function(t){return"function"==typeof t&&(m.system.active=t),this},play:function(){return m.system.run||(m.system.run=function(){var t=Date.now();switch(m.system.gameFlow){case p.system.gameFlowType.menu:m.system.menu();break;case p.system.gameFlowType.run:m.system.runFn();break;case p.system.gameFlowType.stop:m.system.stop();break;case p.system.gameFlowType.over:m.system.over();break;case p.system.gameFlowType.zone:m.system.zone(m.system.zoneArgs);break;case p.system.gameFlowType.active:m.system.active(m.system.activeArgs);break;case p.system.gameFlowType.loadImage:if(null!=g.loadingCallBack){var e=m.image.imgCount,n=m.image.countLoaded>e?e:m.image.countLoaded;n==e&&(m.system.gameFlow=p.system.gameFlowType.loadedImage),e>0&&g.loadingCallBack(n,e,"image"),n==e&&g.loadingEndCallBack&&(g.loadingEndCallBack(n,e,"image"),g.loadingEndCallBack=null),n=e=null}break;case p.system.gameFlowType.loadedImage:m.system.gameFlow=m.system.loadedImageToGameFlow,m.image.imgObjs=[],m.image.countLoaded=0,m.image.inited||g.pageLoaded()}g.buttonLayoutAction(),m.system.spendTime=Date.now()-t,t=null}),m.system.playTimer||(m.system.isPause=!1,(m.system.rafRun=function(){var t=Date.now();t-m.system.lastDate>=m.system.timeout-m.system.spendTime&&(m.system.lastDate=t,m.system.isPause||m.system.run()),t=null,m.system.rafRun&&(m.system.playTimer=requestAnimationFrame(m.system.rafRun))})()),this},pause:function(){return m.system.playTimer&&(m.system.isPause=!0,m.system.rafRun=null,cancelAnimationFrame(m.system.playTimer),m.system.playTimer=null),this},gameFlow:{menu:function(){return null!=m.system.menu&&(m.system.gameFlow=p.system.gameFlowType.menu,v.resetKeys()),this},run:function(){return null!=m.system.runFn&&(m.system.gameFlow=p.system.gameFlowType.run,v.resetKeys()),this},stop:function(){return null!=m.system.stop&&(m.system.gameFlow=p.system.gameFlowType.stop,v.resetKeys()),this},over:function(){return null!=m.system.over&&(m.system.gameFlow=p.system.gameFlowType.over,v.resetKeys()),this},zone:function(t){return null!=m.system.zone&&(m.system.gameFlow=p.system.gameFlowType.zone,m.system.zoneArgs=t,v.resetKeys()),this},active:function(t){return null!=m.system.active&&(m.system.gameFlow=p.system.gameFlowType.active,m.system.activeArgs=t,v.resetKeys()),this},isIn:function(t){return m.system.gameFlow==p.system.gameFlowType[t]},base:function(){return v}},resetKeys:function(){for(var t in m.event.keys)m.event.keys[t]=!1;for(var t in m.event.lastKey)m.event.lastKey[t]=!1;for(var t in m.event.pressedKey)m.event.pressedKey[t]=!1;for(var t in m.event.keyPressCtrl)m.event.keyPressCtrl[t]=!0;return this},canvas:{init:function(){return a={x:0,y:0},o={fillColor:"#000000",strokeColor:"#000000"},r={x:0,y:0},h={x:0,y:0},l={x:0,y:0,fillStyle:"#FFFFFF",strokeStyle:"#CCCCCC"},this.pass()},initDevice:function(){return c=g.getDeviceConfig(),m.canvas.device=c.device,m.canvas.fps=c.fps,m.canvas.touch=c.touch,m.canvas.zoom=c.zoom,this},pass:function(t,e,n){var i,a;return i=t&&""!=t?t:m.canvas.defaultId,m.canvas.ctxs[i]||(a=this.base().getDom(i)||document.createElement("canvas"),m.canvas.ctxs[i]=null,delete m.canvas.ctxs[i],m.canvas.ctxs[i]=a.getContext("2d"),a.width=e||m.canvas.defaultWidth,a.style.width=parseInt(a.width*m.canvas.zoom)+"px",a.height=n||m.canvas.defaultHeight,a.style.height=parseInt(a.height*m.canvas.zoom)+"px",m.canvas.cavansDoms[i]=null,delete m.canvas.cavansDoms[i],m.canvas.cavansDoms[i]=a),(s=m.canvas.ctxs[i]).font=m.canvas.defaultFont,u=m.canvas.cavansDoms[i],d=parseInt(u.width),f=parseInt(u.height),this.screen.setId(i),this},font:function(t){return m.canvas.defaultFont=t,s.font=m.canvas.defaultFont,this},del:function(t){return m.canvas.ctxs[t]&&(m.canvas.ctxs[t]=null,delete m.canvas.ctxs[t],m.canvas.cavansDoms[t]=null,delete m.canvas.cavansDoms[t]),this},setCurrent:function(t){return _canvas.pass(t)},screen:{setId:function(t){return m.canvas.ctxs[t]&&(m.canvas.id=t),this},getId:function(){return m.canvas.id},getWidth:function(){return d},setWidth:function(t){return m.canvas.defaultWidth=t,u&&(u.width=m.canvas.defaultWidth,u.style.width=u.width+"px",d=parseInt(u.width)),this},getHeight:function(){return f},setHeight:function(t){return m.canvas.defaultHeight=t,u&&(u.height=m.canvas.defaultHeight,u.style.height=u.height+"px",f=parseInt(u.height)),this},getDevice:function(){return m.canvas.device},getFps:function(){return m.canvas.fps},setFps:function(t){return t>0&&(m.canvas.fps=t),this},getTouch:function(){return m.canvas.touch},getZoom:function(){return m.canvas.zoom}},fillStyle:function(t){return s.fillStyle=t,this},fillRect:function(t,e,n,i,a){return n=n||0,i=i||0,a?h=g.getAnchor(t,e,n,i,a):(h.x=t,h.y=e),s.fillRect(h.x,h.y,n,i),this},fillText:function(t,e,n,i){return s.font=i||m.canvas.defaultFont,s.fillText(t,e,n),this},clearRect:function(t,e,n,i){return s.clearRect(t,e,n,i),this},clearScreen:function(){return this.clearRect(0,0,d,f)},fillScreen:function(){return this.fillRect(0,0,d,f)},strokeStyle:function(t){return s.strokeStyle=t,this},lineWidth:function(t){return s.lineWidth=t||1,this},strokeRect:function(t,e,n,i,a){return a?r=g.getAnchor(t,e,n,i,a):(r.x=t,r.y=e),s.strokeRect(r.x,r.y,n,i),this},strokeText:function(t,e,n,i){return s.font=i||m.canvas.defaultFont,s.strokeText(t,e,n),this},setColor:function(t,e,n){return null==n?(o.fillColor=t,o.strokeColor=e||t):(o.fillColor="rgb("+t+", "+e+", "+n+")",o.strokeColor=o.fillColor),this.fillStyle(o.fillColor).strokeStyle(o.strokeColor)},drawImage:function(t,e,n,i,o,r,h,l,u,c){var d=v.getImage(t);if(d.refreshed)this.drawCache(t,e,n,i,o,r,h,l,u,c);else if(null!=d.src)null!=l&&(e=e<0?0:e,l=l<=0?.1:l),null!=u&&(n=n<0?0:n,u=u<=0?.1:u),null!=i&&null!=l&&(i=i<=0?.1:e+i<=d.width?i:d.width-e),null!=o&&null!=u&&(o=o<=0?.1:n+o<=d.height?o:d.height-n),d.loaded&&(i?o?c?(a=g.getAnchor(r,h,l,u,c),s.drawImage(d,e,n,i,o,a.x,a.y,l,u)):s.drawImage(d,e,n,i,o,r,h,l,u):(a=g.getAnchor(e,n,d.width,d.height,i),s.drawImage(d,a.x,a.y)):s.drawImage(d,e,n));else{var f=m.image.asyncImgObjs[t];f&&!f.inited&&(g.setImage(f.id,f.src,f.benchId,f.bench,f.cache),f.inited=!0),f=null}return d=null,this},drawRotate:function(t,e,n,i,a,o,r,h,l,u){var c=parseInt(h>>1),d=parseInt(l>>1),f=v.getImage(t),p=f.src?f:m.canvas.cavansDoms[t];return o-=c,r-=d,s.save(),s.translate(o+c,r+d),s.rotate(u*Math.PI/180),s.translate(-(o+c),-(r+d)),s.drawImage(p,e,n,i,a,o,r,h,l),s.restore(),p=null,f=null,d=null,c=null,this},drawCache:function(t,e,n,i,o,r,h,l,u,c){var d=m.canvas.cavansDoms[t];return d&&(null!=l&&(e=e<0?0:e,l=l<=0?.1:l),null!=u&&(n=n<0?0:n,u=u<=0?.1:u),null!=i&&null!=l&&(i=i<=0?.1:e+i<=d.width?i:d.width-e),null!=o&&null!=u&&(o=o<=0?.1:n+o<=d.height?o:d.height-n),i?o?c?(a=g.getAnchor(r,h,l,u,c),s.drawImage(d,e,n,i,o,a.x,a.y,l,u)):s.drawImage(d,e,n,i,o,r,h,l,u):(a=g.getAnchor(e,n,d.width,d.height,i),s.drawImage(d,a.x,a.y)):s.drawImage(d,e,n)),d=null,this},drawRegion:function(t,e,n,i,a,o,r,h,l){switch(o){case p.canvas.trans.TRANS_NONE:default:s.transform(1,0,0,1,r,h);break;case p.canvas.trans.TRANS_ROT90:s.transform(0,1,-1,0,a+r,h);break;case p.canvas.trans.TRANS_ROT180:s.transform(-1,0,0,-1,i+r,a+h);break;case p.canvas.trans.TRANS_ROT270:s.transform(0,-1,1,0,r,i+h);break;case p.canvas.trans.TRANS_MIRROR:s.transform(-1,0,0,1,i+r,h);break;case p.canvas.trans.TRANS_MIRROR_ROT90:s.transform(0,-1,-1,0,a+r,i+h);break;case p.canvas.trans.TRANS_MIRROR_ROT180:s.transform(1,0,0,-1,r,a+h);break;case p.canvas.trans.TRANS_MIRROR_ROT270:s.transform(0,1,1,0,r,h)}var u=v.getImage(t),c=u.cache?this.drawCache:this.drawImage;return c(t,e,n,i,a,0,0,i,a),s.setTransform(1,0,0,1,0,0),c=null,u=null,this},drawRegionAndZoom:function(t,e,n,i,a,o,r,h,l,u,c){switch(o){case p.canvas.trans.TRANS_NONE:default:s.transform(1,0,0,1,r,h);break;case p.canvas.trans.TRANS_ROT90:s.transform(0,1,-1,0,c+r,h);break;case p.canvas.trans.TRANS_ROT180:s.transform(-1,0,0,-1,u+r,c+h);break;case p.canvas.trans.TRANS_ROT270:s.transform(0,-1,1,0,r,u+h);break;case p.canvas.trans.TRANS_MIRROR:s.transform(-1,0,0,1,u+r,h);break;case p.canvas.trans.TRANS_MIRROR_ROT90:s.transform(0,-1,-1,0,c+r,u+h);break;case p.canvas.trans.TRANS_MIRROR_ROT180:s.transform(1,0,0,-1,r,c+h);break;case p.canvas.trans.TRANS_MIRROR_ROT270:s.transform(0,1,1,0,r,h)}var d=v.getImage(t),f=d.cache?this.drawCache:this.drawImage;return f(t,e,n,i,a,0,0,u,c),s.setTransform(1,0,0,1,0,0),f=null,d=null,this},drawNumber:function(t,e,n,i,s,a,o,r,h){var l=t.toString(),u=l.length,c=r||n,f=h||i;if("center"==o){for(var m=s+parseInt(d-c*u>>1),p=0;p<u;p++)this.drawImage(e,parseInt(l.charAt(p))*n,0,n,i,m+p*c,a,c,f);m=null}else if(1==o)for(p=0;p<u;p++)this.drawImage(e,parseInt(l.charAt(p))*n,0,n,i,s+p*c,a,c,f);else if(0==o)for(p=u-1;p>=0;p--)this.drawImage(e,parseInt(l.charAt(p))*n,0,n,i,s-(u-1-p)*c,a,c,f,v.graphics.ANCHOR_RT);return f=null,c=null,u=null,l=null,this},moveTo:function(t,e){return s.moveTo(t,e),this},lineTo:function(t,e){return s.lineTo(t,e),this},stroke:function(){return s.stroke(),this},fill:function(){return s.fill(),this},beginPath:function(){return s.beginPath(),this},closePath:function(){return s.closePath(),this},arc:function(t,e,n,i,a,o){return s.arc(t,e,n,i,a,o),this},quadraticCurveTo:function(t,e,n,i){return s.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,a,o){return s.bezierCurveTo(t,e,n,i,a,o),this},measureText:function(t){var e=s.measureText(t),n=e.width,i=e.height?e.height:parseInt(s.font);return{width:"j2me"==this.screen.getDevice()?s.measureText(t):n,height:i}},translate:function(t,e){return s.translate(t,e),this},drawLine:function(t,e,n,i){return this.beginPath().moveTo(t,e).lineTo(n,i).closePath().stroke()},drawRect:function(t,e,n,i,s){return this.strokeRect(t,e,n,i,s)},drawString:function(t,e,n,i,a,o,r,h){if(l.x=e,l.y=n,s.font=h||m.canvas.defaultFont,i)switch(i){case p.canvas.graphics.LEFT:l.x=0;break;case p.canvas.graphics.VCENTER:l.x=parseInt(this.screen.getWidth()-this.measureText(t).width>>1);break;case p.canvas.graphics.RIGHT:l.x=this.screen.getWidth()-this.measureText(t).width}return a&&(l.fillStyle=o||"#000000",l.strokeStyle=r||"#CCCCCC",this.fillStyle(l.strokeStyle).fillText(t,l.x+1,l.y+1,h).fillStyle(l.fillStyle)),this.fillText(t,l.x,l.y,h).fillStyle(m.canvas.defaultColor)},drawSubstring:function(t,e,n,i,s,a,o,r,h,l){return this.drawString(t.substring(e,e+n),i,s,a,o,r,h,l)},clip:function(){return s.clip(),this},save:function(){return s.save(),this},restore:function(){return s.restore(),this},rect:function(t,e,n,i){return s.rect(t,e,n,i),this},rotate:function(t){return s.rotate(t),this},setTransform:function(t,e,n,i,a,o){return s.setTransform(t,e,n,i,a,o),this},scale:function(t,e){return s.scale(t,e),this},globalAlpha:function(t){return s.globalAlpha=t,this},getContext:function(){return s},base:function(){return v}},pushImage:function(t,e){if(m.image.inited)return this;for(var n,i=0,s=t.length;i<s;i++)(n=t[i])&&!m.image.initImgs[n.id]&&(m.image.initImgs[n.id]=!0,m.image.imgObjs.push(t[i]));return this.loadingEndCallBack(e),n=null,this},loadImage:function(t,e){if(m.system.gameFlow!=p.system.gameFlowType.loadImage&&t.length>0){m.system.loadedImageToGameFlow=m.system.gameFlow,m.system.gameFlow=p.system.gameFlowType.loadImage,m.image.imgObjs=t,m.image.imgCount=m.image.imgObjs.length,m.image.countLoaded=0;for(var n,i=0;n=m.image.imgObjs[i];i++)m.image.imgs[n.id]?m.image.countLoaded++:g.setImage(n.id,n.src,n.benchId);this.loadingEndCallBack(e)}return this},asyncImage:function(t){for(var e,n=0,i=t.length;n<i;n++)e=t[n]||{},m.image.asyncImgObjs[e.id]||(m.image.asyncImgObjs[e.id]=e);return e=null,this},loadingCallBack:function(t){return"function"==typeof t&&(g.loadingCallBack=t),this},loadingEndCallBack:function(t){return"function"==typeof t&&(g.loadingEndCallBack=t),this},getImage:function(t){return m.image.imgs[t]?m.image.imgs[t]:{src:null}},delImage:function(t,e){return m.image.imgs[t]&&(m.image.imgs[t]=null,delete m.image.imgs[t],e&&(m.image.imgs[t]={id:t,loaded:!0,cache:!0,refreshed:!0})),this},audio:{play:function(t){var e=m.audio.audios[t];if(e)try{e.currentTime>=e.duration?this.replay(t):e.paused&&e.play()}catch(p){}return e=null,this},playRange:function(t,e,n){var i=m.audio.audios[t];if(i)try{i.__timeupdateCallBack__||i.addEventListener("timeupdate",i.__timeupdateCallBack__=function(){this.currentTime>=this.__to__&&(this.loop?this.currentTime=this.__from__:this.pause())},!1),i.__from__=null==e?0:e,i.__to__=null==n?i.duration:n,this.setCurrentTime(i.id,i.__from__).play(i.id)}catch(s){}return i=null,this},pause:function(t){if(m.audio.audios[t])try{m.audio.audios[t].pause()}catch(i){}return this},pauseAll:function(){for(var t in m.audio.audios)this.pause(t);return this},mute:function(t,e){if(m.audio.audios[t])try{m.audio.audios[t].muted=e}catch(p){}},vol:function(t,e){if(m.audio.audios[t])try{m.audio.audios[t].volume=e}catch(p){}return this},loop:function(t,e){if(m.audio.audios[t])try{m.audio.audios[t].loop=e}catch(p){}return this},replay:function(t){return this.setCurrentTime(t,0).play(t),this},setCurrentTime:function(t,e){var n=m.audio.audios[t];if(n)try{e<0?e=0:e>n.duration&&(e=n.duration),n.currentTime=e||0}catch(g){}return n=null,this},getAudio:function(t){return m.audio.audios[t]},del:function(t){var e=m.audio.audios[t];return e&&e.__timeupdateCallBack__&&(e.pause(),e.removeEventListener("timeupdate",e.__timeupdateCallBack__,!1),m.audio.audios[t]=null,delete m.audio.audios[t]),e=null,this},base:function(){return v}},initAudio:function(t){if(!window.Audio)return this;if(t.length>0){var e;m.audio.audios={};for(var n=0;n<t.length;n++)(e=t[n])&&g.setAudio(e.id,e.src,e.loop,e.autoplay,e.preload,e.autobuffer);e=null}return this},events:{keyDown:function(t){return m.event.keyDownGo||(m.event.keyDownGo=!0),m.event.keyUpGo||(m.event.keyUpGo=!0),m.event.keyPressedGo||(m.event.keyPressedGo=!0),m.event.keyDownCallBack=t,this},keyUp:function(t){return m.event.keyDownGo||(m.event.keyDownGo=!0),m.event.keyUpGo||(m.event.keyUpGo=!0),m.event.keyPressedGo||(m.event.keyPressedGo=!0),m.event.keyUpCallBack=t,this},orientationChange:function(t){return m.event.orientationChange=t,this},touchStart:function(t){return m.event.touchStart=t,this},touchEnd:function(t){return m.event.touchEnd=t,this},touchMove:function(t){return m.event.touchMove=t,this},touchCancel:function(t){return m.event.touchCancel=t,this},click:function(t){return m.event.clickCallBack=t,this},mouseDown:function(t){return m.event.mouseDownCallBack=t,this},mouseUp:function(t){return m.event.mouseUpCallBack=t,this},mouseMove:function(t){return m.event.mouseMoveCallBack=t,this},createEvent:function(t,e){var n=document.getElementById(t);if(n){var i=document.createEvent("HTMLEvents");i.initEvent(e,!1,!0),n.dispatchEvent(i),i=null}n=null},pageFocus:function(t){return m.event.pageFocusCallBack=t,this},pageUnFocus:function(t){return m.event.pageUnFocusCallBack=t,this},swipe:function(t,e,n){m.event.swipeCallBack=t,null!=e&&(m.event.swipeTimeout=e),null!=n&&(m.event.swipeRange=n)},base:function(){return v}},ui:{},graphics:{HCENTER:p.canvas.graphics.HCENTER,VCENTER:p.canvas.graphics.VCENTER,LEFT:p.canvas.graphics.LEFT,RIGHT:p.canvas.graphics.RIGHT,TOP:p.canvas.graphics.TOP,BOTTOM:p.canvas.graphics.BOTTOM},trans:{TRANS_NONE:p.canvas.trans.TRANS_NONE,TRANS_ROT90:p.canvas.trans.TRANS_ROT90,TRANS_ROT180:p.canvas.trans.TRANS_ROT180,TRANS_ROT270:p.canvas.trans.TRANS_ROT270,TRANS_MIRROR:p.canvas.trans.TRANS_MIRROR,TRANS_MIRROR_ROT90:p.canvas.trans.TRANS_MIRROR_ROT90,TRANS_MIRROR_ROT180:p.canvas.trans.TRANS_MIRROR_ROT180,TRANS_MIRROR_ROT270:p.canvas.trans.TRANS_MIRROR_ROT270},request:{init:function(){g.initUrlParams(location.href)},get:function(t){return m.request.gets[t]?m.request.gets[t]:""}},buttonLayout:{create:function(t){var e=this.base().objExtend({id:"",value:"",x:0,y:0,width:60,height:30,bgColor:"#000",bgStroke:"#FFF",stroke:"#000",font:"12px Arial",imageId:"",sx:0,sy:0,color:"#FFF",hx:0,hy:0,hColor:"#0FF",dex:0,dey:0,deColor:"#CCC",hided:!1,disabled:!1,path:[]},t||{});return this.get(e.id)||m.buttonLayout.buttons.push(new m.buttonLayout.Button(e)),e=null,this},clear:function(){for(var t,e=m.buttonLayout.buttons,n=e.length-1;n>=0;n--)(t=e[n])&&(t.disposed(),e.splice(n,1));return e=t=null,this},gone:function(t,e,n){var i=this.get(t);if(i){var s=e||[];i.gone(s,n),s=null}return i=null,this},get:function(t){var e=m.buttonLayout.buttons;return e[e.indexOfAttr("id",t)]},show:function(t){var e=this.get(t);return e&&e.show(),e=null,this},hide:function(t){var e=this.get(t);return e&&e.hide(),e=null,this},disable:function(t,e){var n=this.get(t);return n&&n.disable(e),n=null,this},repeated:function(t){var e=this.get(t);if(e)return e.repeated},pressed:function(t){var e=this.get(t);if(e){var n=e.pressed;return e.pressed=!1,n}},released:function(t){var e=this.get(t);if(e){var n=e.released;return e.released=!1,n}},base:function(){return v}}}.init();var v=e=t,y=document.getElementsByTagName("head")[0],R=null,w=null,b=null,x=null,T=function(){w&&(clearTimeout(w),w=null)};t.getScript=function(t){if(!y||R)return!1;var e=v.objExtend({url:"",before:function(){},success:function(){},error:function(t){},timeout:5e3,contentType:"text/javascript",destroyed:!0},t||{});return""!=e.url&&(e.before(),(R=document.createElement("script")).type=e.contentType,R.async=!0,R.src=e.url,R.destroyed=e.destroyed,b=e.success,x=e.error,R.onload=function(){T(),b&&(b(),b=null),this.destroyed&&y.removeChild(this),R=null},y.appendChild(R),T(),w=setTimeout((function(){T(),x&&(x("timeout"),x=null),R&&R.destroyed&&y.removeChild(R),R=null}),e.timeout)),e=null,v};var k=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};t.getNewGuid=function(){return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()},t.classes.Observer=function(){this.group=[]},t.classes.Observer.prototype.register=function(t){return null==t||-1==v.comm.inArray(t,this.group)&&this.group.push(t),this},t.classes.Observer.prototype.unregister=function(t){if(null==t)return this;var e=v.commandFuns.inArray(t,this.group);return e>-1&&this.group.splice(e,1),this},t.classes.Observer.prototype.notify=function(t){for(var e=0;e<this.group.length;e++)null!=this.group[e]&&this.group[e](t);return this},t.classes.Observer.prototype.clear=function(){return this.group.length>0&&this.group.splice(0,this.group.length),this},t.classes.Timer=function(t,e,n,i,s){this.id=t,this._initTime=e,this._dateTime=Date.now(),this.time=this._initTime,this.callBack=n,this.millisec=i||1e3,this.data=s,this.timeout=null},t.classes.Timer.prototype.stop=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},t.classes.Timer.prototype.start=function(t){t&&(this.time=this._initTime,this._dateTime=Date.now()),this.stop(),this.timeout=setTimeout((function(t){var e=Date.now(),n=parseInt(Math.round((e-t._dateTime)/t.millisec));t._dateTime=e,t.time-=n,t.callBack?t.callBack(t):t.stop(),t.time>=0?t.start():(t.stop(),t.time=0),e=n=null}),this.millisec,this)},t.classes.WebSocket=function(t,e,n,i,s){this.ipPort=t||"",this.socket=new WebSocket(this.ipPort),this.socket.onopen=e,this.socket.onmessage=n,this.socket.onclose=i,this.socket.onerror=s},t.classes.WebSocket.prototype.send=function(t){this.socket.send(t)},t.classes.WebSocket.prototype.close=function(){this.socket.close()},t.classes.observer=t.classes.Observer,t.classes.timer=t.classes.Timer,t.classes.webSocket=t.classes.websocket=t.classes.WebSocket,t.commandFuns=t.comm,t.commandFuns.collisionCheck=t.commandFuns.collision,t.commandFuns.circleCollisionCheck=t.commandFuns.circleCollision,t.initImage=t.pushImage,"function"==typeof define&&define("lib/link",[],(function(){return t}))})(),define("lib/action",["lib/link"],(function(e){var n=function(t,e){return 0==t&&0==e?0:t>0&&e<0?1:t>0&&0==e?2:t>0&&e>0?3:0==t&&e>0?4:t<0&&e>0?5:t<0&&0==e?6:t<0&&e<0?7:0},i=function(t,n,i,s,a){var o=[];if(a.length>0){for(var r,h=0;h<a.length;h++){s=[],r=a[h].frames;for(var l=0;l<r.length;l++)s.push({args:[r[l][0],r[l][1],r[l][2]],step:r[l][3]});o.push(new e.action.sprite(s,a[h].loop,0))}return s=r=null,o}return t};e.action={},e.action.Role=function(t,e,n,s,a,o,r,h){this.imageNames=a||[],this.rects=o||[],this.frames=r||[],this.actions=h||[],this.sprites=i(t,this.imageNames,this.rects,this.frames,this.actions)||[],this.x=e||0,this.y=n||0,this.dx=0,this.dy=0,this.step=0,this.id="",this.mapOffx=this.x,this.mapOffy=this.y,this.svx=null,this.svy=null,this.current=s||0,this._cr=this.current,this.zoom=1,this.angle=0,this._zooms=[],this._angles=[],this._moveDs=[4,7,5,5,6,-5,-5,-7],this._stopDs=[0,-3,1,1,2,-1,-1,-3],this.dsIndex=4,this._path=[];var l=this.getSprite(),u=l.getFrame(),c=this.frames[u.args[0]];this._fA=c.fA,this.aR=c.aR,this.bR=c.bR,this._skipMoveDs=!1,this._stopedAction=null,c=u=l=null,this.onend=null,this.onstart=null,this._locked=!1,this.speed=5,this.links=[],this.polyAR=[[0,0],[0,0],[0,0],[0,0]],this.aabbAR=[[0,0],[0,0],[0,0],[0,0]],this.polyBR=[[0,0],[0,0],[0,0],[0,0]],this.aabbBR=[[0,0],[0,0],[0,0],[0,0]]},e.action.Role.prototype.setSprite=function(t,n,i){if(this._locked)return this;var s,a=null!=t?t:0,o=a>=0?e.trans.TRANS_NONE:e.trans.TRANS_MIRROR;this._cr!=a&&(this._cr=a,a<0&&(a=Math.abs(a)),this.current=a>=this.sprites.length?this.sprites.length-1:a,this.sprites.length>1&&this.setTrans(o),(s=this.getSprite()).getFrame(),n||s.setFrame(0),i&&(this._stopedAction=this._cr),this.updateFrameParam());for(var r,h=0;r=this.links[h];h++)r.setSprite(t,n,i);return a=trans=s=null,this},e.action.Role.prototype.addLinks=function(t){this.links=t||[];for(var n,i=0;n=this.links[i];i++)n.setSprite(this.getSprite().trans==e.trans.TRANS_NONE?this.current:-this.current).setStep(this.step);return this},e.action.Role.prototype.clearLinks=function(){return this.links=[],this},e.action.Role.prototype.lockSprite=function(){return this._locked=!0,this},e.action.Role.prototype.unlockSprite=function(){return this._locked=!1,this},e.action.Role.prototype.setTrans=function(t){return this.getSprite().trans=t,this},e.action.Role.prototype.getSprite=function(t){return this.sprites[null==t?this.current:t]},e.action.Role.prototype.getFrame=function(t){return this.frames[null==t?this.getSprite().getFrame().args[0]:t]},e.action.Role.prototype.updateFrameParam=function(t){var n=this.getSprite();if(!n)return n=null,this;var i,s=n.getFrame();if(s&&s.args&&(i=this.frames[s.args[0]])){this._fA=i.fA,this.aR=i.aR,this.bR=i.bR;var a=this.getAttackRect(),o=this.getBodyRect(),r=0,h=0,l=0,u=0;this.polyAR[0][0]=a.x,this.polyAR[0][1]=a.y,this.polyAR[1][0]=a.x+a.width,this.polyAR[1][1]=a.y,this.polyAR[2][0]=a.x+a.width,this.polyAR[2][1]=a.y+a.height,this.polyAR[3][0]=a.x,this.polyAR[3][1]=a.y+a.height,this.polyBR[0][0]=o.x,this.polyBR[0][1]=o.y,this.polyBR[1][0]=o.x+o.width,this.polyBR[1][1]=o.y,this.polyBR[2][0]=o.x+o.width,this.polyBR[2][1]=o.y+o.height,this.polyBR[3][0]=o.x,this.polyBR[3][1]=o.y+o.height,0!=this.angle&&e.comm.setMatrixRotate(this.polyAR,this.angle).setMatrixRotate(this.polyBR,this.angle);for(var c=0,d=this.polyAR,f=this.aabbAR;c++<2;){for(var m,p=0;m=d[p];p++)m[0]>h&&(h=m[0]),m[0]<r&&(r=m[0]),m[1]>u&&(u=m[1]),m[1]<l&&(l=m[1]);f[0][0]=r,f[0][1]=l,f[1][0]=h,f[1][1]=l,f[2][0]=h,f[2][1]=u,f[3][0]=r,f[3][1]=u,d=this.polyBR,f=this.aabbBR}a=o=r=h=l=u=null}return n=s=i=null,this},e.action.Role.prototype.action=function(){var t=this.getSprite();if(!t)return this;var e=t.getFrame(),i=0,s=0;if(e){if(this.updateFrameParam(),this._path.length>0){var a=this._path.shift();i=a[0]||0,s=a[1]||0,a=null,this._skipMoveDs||this.setSprite(this._moveDs[this.dsIndex=n(i,s)],!0),this.svx=i,this.svy=s,this.mapOffx+=this.svx,this.mapOffy+=this.svy}else null!=this.svx&&null!=this.svy&&(this._skipMoveDs||(this.setSprite(this._stopedAction||this._stopDs[this.dsIndex=n(this.svx,this.svy)]),this._stopedAction=null),this.onend&&this.onend(this),this._skipMoveDs=!1,this.svx=null,this.svy=null);if(this._zooms.length>0){var o=this._zooms.shift();"number"==typeof~~o&&this.setZoom(o),o=null}if(this._angles.length>0){var r=this._angles.shift();"number"==typeof~~r&&this.setRotate(r),o=null}this.x+=e.args[1]+i,this.y+=e.args[2]+s;for(var h,l=0;h=this.links[l];l++)h.x=this.x+(h.dx||0),h.y=this.y+(h.dy||0),h.getSprite().setFrame(t.current),h.updateFrameParam();null}return t.nextFrame(),t=i=s=e=null,this},e.action.Role.prototype.render=function(t){var n=this.getSprite();if(n&&this._fA){var i,s,a,o=this._fA,r=o.length,h=e.canvas,l=n.trans;if(this.angle>0){o[0];var u=this.x,c=this.y;e.canvas.save().translate(u,c).rotate(this.angle*Math.PI/180).translate(-u,-c),u=c=null}for(var d=0;d<r;d++)i=this.rects[o[d][0]][o[d][1]],s=this.imageNames[o[d][0]],a=e.getImage(s),l==e.trans.TRANS_NONE?h.drawImage(s,i[0],i[1],i[2],i[3],1==this.zoom?~~(this.x+this.dx+o[d][2]*this.zoom):this.x+this.dx+o[d][2]*this.zoom,1==this.zoom?~~(this.y+this.dy+o[d][3]*this.zoom):this.y+this.dy+o[d][3]*this.zoom,i[2]*this.zoom,i[3]*this.zoom):1==this.zoom?h.drawRegion(s,i[0],i[1],i[2],i[3],l,~~(this.x+this.dx-(o[d][2]+i[2])),~~(this.y+this.dy+o[d][3])):h.drawRegionAndZoom(s,i[0],i[1],i[2],i[3],l,this.x+this.dx-(o[d][2]+i[2])*this.zoom,this.y+this.dy+o[d][3]*this.zoom,null,i[2]*this.zoom,i[3]*this.zoom),!a.loaded&&a.bench&&h.drawImage(a.bench.id||a.benchId,a.bench.sx||0,a.bench.sy||0,a.bench.sw||a.bench.w,a.bench.sh||a.bench.h,~~(this.x+this.dx-(a.bench.w*this.zoom>>1)),~~(this.y+this.dy-a.bench.h*this.zoom),a.bench.w*this.zoom,a.bench.h*this.zoom);this.angle>0&&e.canvas.restore();for(var f,m=0;f=this.links[m];m++)f.render();h=r=o=l=i=s=a=null}return n=null,this},e.action.Role.prototype.setZoom=function(t){return this.zoom=t,this},e.action.Role.prototype.setZoomTransition=function(t){return t&&t.length>0&&(this._zooms=t),this},e.action.Role.prototype.endZoomTransition=function(){return 0==this._zooms.length},e.action.Role.prototype.getBodyRect=function(t,n){var i=this.getSprite(null!=t?Math.abs(t):null);if(!i)return null;var s=i.getFrame(n);if(!s)return null;var a=this.frames[s.args[0]].bR;return null==t&&i.trans!=e.trans.TRANS_NONE||t<0?{x:-(a[0]+a[2]*this.zoom),y:a[1]*this.zoom,width:a[2]*this.zoom,height:a[3]*this.zoom}:{x:a[0]*this.zoom,y:a[1]*this.zoom,width:a[2]*this.zoom,height:a[3]*this.zoom}},e.action.Role.prototype.getAttackRect=function(t,n){var i=this.getSprite(null!=t?Math.abs(t):null);if(!i)return null;var s=i.getFrame(n);if(!s)return null;var a=this.frames[s.args[0]].aR;return null==t&&i.trans!=e.trans.TRANS_NONE||t<0?{id:this.id,x:-(a[0]+a[2]*this.zoom),y:a[1]*this.zoom,width:a[2]*this.zoom,height:a[3]*this.zoom}:{id:this.id,x:a[0]*this.zoom,y:a[1]*this.zoom,width:a[2]*this.zoom,height:a[3]*this.zoom}},e.action.Role.prototype.getAABBBodyRect=function(){return{id:this.id,x:this.aabbBR[0][0],y:this.aabbBR[0][1],width:Math.abs(this.aabbBR[1][0]-this.aabbBR[0][0]),height:Math.abs(this.aabbBR[2][1]-this.aabbBR[1][1])}},e.action.Role.prototype.getAABBAttackRect=function(){return{id:this.id,x:this.aabbAR[0][0],y:this.aabbAR[0][1],width:Math.abs(this.aabbAR[1][0]-this.aabbAR[0][0]),height:Math.abs(this.aabbAR[2][1]-this.aabbAR[1][1])}},e.action.Role.prototype.setStep=function(t){this.step=t||0;for(var e=0,n=this.sprites.length;e<n;e++)this.sprites[e].setStep(t);for(var i,s=0;i=this.links[s];s++)i.setStep(this.step);return this},e.action.Role.prototype.collision=function(t,n,i){if(!t)return!1;var s,a,o=n||"aR",r=i||"aR";return"aR"==o?s=this.getAttackRect():"bR"==o&&(s=this.getBodyRect()),"aR"==r?a=t.getAttackRect():"bR"==r&&(a=t.getBodyRect()),!(!s||!a)&&e.comm.collision(~~(this.x+this.dx+s.x),~~(this.y+this.dy+s.y),~~s.width,~~s.height,~~(t.x+t.dx+a.x),~~(t.y+t.dy+a.y),~~a.width,~~a.height)},e.action.Role.prototype.collisionInput=function(t,n,i,s,a){var o,r=a||"aR";return"aR"==r?o=this.getAttackRect():"bR"==r&&(o=this.getBodyRect()),!!o&&e.comm.collision(~~(this.x+this.dx+o.x),~~(this.y+this.dy+o.y),~~o.width,~~o.height,t,n,i,s)},e.action.Role.prototype.circleCollisionInput=function(t,n,i,s){var a,o=s||"aR";return"aR"==o?a=this.getAttackRect():"bR"==o&&(a=this.getBodyRect()),!!a&&e.comm.rect2CircleCollision(~~(this.x+this.dx+a.x),~~(this.y+this.dy+a.y),~~a.width,~~a.height,t,n,i)},e.action.Role.prototype.polygonSATCollision=function(t,n,i){if(!t)return!1;var s,a,o=n||"aR",r=i||"aR";return"aR"==o?s=this.polyAR:"bR"==o&&(s=this.polyBR),"aR"==r?a=t.polyAR:"bR"==r&&(a=t.polyBR),!(!s||!a)&&e.comm.polygonCollision(s,a,this.x+this.dx,this.y+this.dy,t.x+t.dx,t.y+t.dy)},e.action.Role.prototype.setLoop=function(t){for(var e=0,n=this.sprites.length;e<n;e++)this.sprites[e].setLoop(t);return this},e.action.Role.prototype.setPath=function(t,e){return this._path=t||[],this._path.length>0&&this.onstart&&this.onstart(this),e&&(this._skipMoveDs=!0),this},e.action.Role.prototype.concatPath=function(t){return this._path=this._path.concat(t||[]),this},e.action.Role.prototype.endPath=function(){return 0==this._path.length},e.action.Role.prototype.clearPath=function(){return this._path=[],this},e.action.Role.prototype.getPathCount=function(){return this._path.length},e.action.Role.prototype.getFirstPath=function(){return this._path.length>0?this._path[0]:[0,0]},e.action.Role.prototype.moveTo=function(t,n,i){return i&&(this.speed=Math.abs(i)),this.setPath(e.comm.createPath(this.mapOffx,this.mapOffy,t,n,this.speed)),this},e.action.Role.prototype.setMoveDs=function(t){return this._moveDs=t||[4,7,5,5,6,-5,-5,-7],this},e.action.Role.prototype.setStopDs=function(t){return this._stopDs=t||[0,-3,1,1,2,-1,-1,-3],this},e.action.Role.prototype.doMoveDs=function(t){return null!=t&&t>=0&&t<8&&(this.dsIndex=t),this.setSprite(this._moveDs[this.dsIndex]),this},e.action.Role.prototype.doStopDs=function(t){return null!=t&&t>=0&&t<8&&(this.dsIndex=t),this.setSprite(this._stopDs[this.dsIndex]),this},e.action.Role.prototype.mark=function(t,e,n,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=n&&(this.mapOffx=n),null!=i&&(this.mapOffy=i),this},e.action.Role.prototype.setSpeed=function(t,e){return t&&(this.speed=Math.abs(t)),this.nodeXStep=t,this.nodeYStep=e,this},e.action.Role.prototype.setRotate=function(t){return t!=this.angle&&(Math.abs(t)>360&&(t%=360),this.angle=t<0?360+t:t),this},e.action.Role.prototype.setRotateTransition=function(t){return t&&t.length>0&&(this._angles=t),this},e.action.Role.prototype.endRotateTransition=function(){return 0==this._angles.length},e.action.Role.prototype.move=function(t,e){return null!=t&&(this.x+=t),null!=e&&(this.y+=e),this},e.action.Role.prototype.rotate=function(t){return null!=t&&this.setRotate(this.angle+t),this},e.action.Role.prototype.stoped=function(){return null==this.svx},e.action.Role.prototype.getCurrent=function(){return this.current*(this.getSprite().trans==e.trans.TRANS_NONE?1:-1)},e.action.Sprite=function(t,n,i,s){this.frames=t||[],this.loop=n,this.current=i||0,this.step=s||0,this.trans=e.trans.TRANS_NONE,this.setFrame(i),this.runStep=this.getFrame().step||this.step},e.action.Sprite.prototype.setFrame=function(t){return this.current=t>=this.frames.length?this.frames.length-1:t>0?t:0,this.getFrame().step&&(this.runStep=this.getFrame().step),this},e.action.Sprite.prototype.getFrame=function(t){return this.frames[null==t?this.current:t]},e.action.Sprite.prototype.nextFrame=function(){return!this.loop&&this.endFrame()||this.frames.length>0&&(this.runStep<=0?(this.loop?(this.current++,this.current%=this.frames.length):this.current<this.frames.length-1&&this.current++,this.getFrame().step?this.runStep=this.getFrame().step:this.runStep=this.step):this.runStep--),this},e.action.Sprite.prototype.preFrame=function(){return this.frames.length>0&&(this.runStep<=0?(this.loop?(this.current--,this.current<0&&(this.current=this.frames.length-1)):this.current>0&&this.current--,this.getFrame().step?this.runStep=this.getFrame().step:this.runStep=this.step):this.runStep--),this},e.action.Sprite.prototype.endFrame=function(t){var e=this.frames.length-1;return null!=t&&t>=0&&t<=this.frames.length-1&&(e=t),this.current>=e&&0==this.runStep},e.action.Sprite.prototype.firstFrame=function(){return 0==this.current&&0==this.runStep},e.action.Sprite.prototype.setStep=function(t){return this.step=t||0,this.runStep=this.getFrame().step||this.step,this},e.action.Sprite.prototype.setLoop=function(t){return this.loop=t,this};var s;return e.action.Fragment=function(t){this.sprites=t||[]},e.action.Fragment.prototype.queue=function(){return function(t){return t.sprites.length>0?t.sprites[0].frames.length>0&&(t.sprites[0].runStep<=0?(t.sprites[0].runStep=t.sprites[0].step,s=t.sprites[0].frames.shift(),0==t.sprites[0].frames.length&&t.sprites.shift()):(s=t.sprites[0].getFrame(),t.sprites[0].runStep--)):s=null,s}(this)},e.action.role=e.action.Role,e.action.sprite=e.action.Sprite,e.action.fragment=e.action.Fragment,t.action})),define("host",["lib/link"],(function(t){t.asyncImage([{id:"host",src:"images/xiaoren.png"}]);var e=["host"],n=[[[0,0,26,37],[27,0,19,36],[46,0,22,38]]],i=[{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,0,-14,-37,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,1,-9,-36,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,2,-12,-37,0]]}],s=[{loop:!0,frames:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[1,0,0,0]]}];return{get:function(a,o){var r=a>=0&&s[a]?[s[a]]:s;return new t.action.role([],0,0,0,o||e,n,i,r||s)}}})),define("shine",["lib/link"],(function(t){t.asyncImage([{id:"shine",src:"images/wu.png"}]);var e=["shine"],n=[[[0,20,101,64],[119,19,112,66],[238,13,140,80],[391,0,103,100]]],i=[{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,0,-51,-34,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,1,-54,-34,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,2,-58,-35,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,3,-49,-45,0]]}],s=[{loop:!1,frames:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[3,0,0,0]]}];return{get:function(a,o){var r=a>=0&&s[a]?[s[a]]:s;return new t.action.role([],0,0,0,o||e,n,i,r||s)}}})),define("index",["lib/link","lib/action","host","shine"],(function(t,e,r,h){return{init:function(){var e,l,u;Date.now();t.canvas.screen.getTouch()?(e=window.innerWidth,l=window.innerHeight,t.canvas.screen.setWidth(e).setHeight(l),u=l-640>>1):(window.onresize=function(){e=window.innerWidth,l=window.innerHeight,t.canvas.screen.setWidth(e).setHeight(l),u=l-640>>1},window.onresize());var c=function(t,e){var n=~~(t/1e3%1*1e3);return 0==n?n="000":n<100&&(n+="0"),~~(t/1e3)+"."+n+(e||'"')};t.run((function(){var n=Date.now();t.canvas.fillStyle("#FFF").fillScreen();var i=~~(640/f.scenes.length);if(f.died){for(a=0;s=f.scenes[a];a++)s.host.action(),s.render();f.shine&&(f.shine.action().render(),f.shine.getSprite().endFrame()&&(f.shine=null)),n-f.dieDate>=f.dieTimeout&&(f.dieDate=null,p())}else{f.time=n-f.date;for(var s,a=0;s=f.scenes[a];a++)if(s.action(0,u+(a+1)*i,e,i,-8).render(),s.hostDied){f.died=!0,f.dieDate=Date.now(),f.shine=h.get(0).mark(s.host.x,s.host.y-20).setStep(2);break}}var o=c(f.time);t.canvas.fillStyle("#000").font("30px Arial").fillText(o,e-t.canvas.measureText(o).width-20,50),n=null})).menu((function(){t.canvas.fillStyle("#FFF").fillScreen().drawImage("logo",e-480>>1,u).drawImage("btns1",0,99,480,7,e-480>>1,u+140,480,7).drawImage("btns1",0,99,480,7,e-480>>1,u+555,480,7),t.buttonLayout.released("difficulty1")?(f.moduleName="我的成绩",o(),m(2)):t.buttonLayout.released("difficulty2")?(f.moduleName="噩梦模式",m(3)):t.buttonLayout.released("difficulty3")?(f.moduleName="地狱模式",m(4)):t.buttonLayout.released("difficulty4")?(f.moduleName="炼狱模式",m(5)):t.buttonLayout.released("rank")&&dp_Ranking()})).zone((function(){t.canvas.fillStyle("#90EE90").fillScreen().fillStyle("#FFF").drawString(f.moduleName,0,u+110,t.graphics.VCENTER,!1,null,null,"50px 微软雅黑").drawImage("btns1",0,106,480,7,e-480>>1,u+140,480,7).drawImage("btns1",0,106,480,7,e-480>>1,u+555,480,7).fillStyle("#000").drawString(c(f.time,"秒"),0,u+340,t.graphics.VCENTER,!1,null,null,"60px 微软雅黑").fillStyle("#000").drawString("最佳:"+c(f.bestTime,"秒"),0,u+400,t.graphics.VCENTER,!1,null,null,"30px 微软雅黑"),f.time>f.bestTime&&t.canvas.fillStyle("#FF0").drawString("新纪录",0,u+240,t.graphics.VCENTER,!1,null,null,"50px 微软雅黑"),t.buttonLayout.released("return")?d():t.buttonLayout.released("restart")&&s(f.time)})).events.mouseDown((function(t,e,n){if(f.died)return!1;for(var i,s=0;i=f.scenes[s];s++)i.touchStart(e,n)})).touchStart((function(t,e,n){if(f.died)return!1;for(var i,s=0;i=f.scenes[s];s++)i.touchStart(e,n)}));var d=function(){a(),t.buttonLayout.clear().create({id:"difficulty1",value:"开始游戏",x:e-272>>1,y:u+180,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty2",value:"噩梦模式",x:e-272>>1,y:u+160+120,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty3",value:"地狱模式",x:e-272>>1,y:u+160+120+100,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty4",value:"炼狱模式",x:e-272>>1,y:u+160+120+200,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).base().gameFlow.menu()};d();var f={moduleName:"",module:0,time:0,bestTime:0,date:null,died:!1,dieTimeout:1e3,dieDate:null,scenes:[],shine:null,Scene:t.extend((function(e){this.id=e,this.x=0,this.baseY=0,this.width=0,this.height=0,this.host=r.get().setStep(2),this.hostDied=!1,this.boxes=[],this.displayDate=Date.now(),this.displayTimeout=t.comm.getRandom(1e3,2e3)}),null,{render:function(){t.canvas.fillStyle("#000").fillRect(this.x,this.baseY-5,this.width,5);for(var e,n=this.boxes.length-1;e=this.boxes[n];n--)t.canvas.fillRect(e.x,e.y,e.width,e.height);return this.host.render(),this},action:function(e,n,i,s,a){if(this.x=e,this.baseY=n,this.width=i,this.height=s,!this.hostDied){this.host.endPath()&&this.host.mark(this.x+100,this.baseY-5);var o=Date.now();if(o-this.displayDate>=this.displayTimeout){this.displayDate=o;var r=t.comm.getRandom(5,30),h=t.comm.getRandom(10,50);this.boxes.unshift({x:this.width,y:0,width:r,height:h}),this.displayTimeout=t.comm.getRandom(1e3,3e3),r=h=null}for(var l,u=this.boxes.length-1;l=this.boxes[u];u--)l.x+=a,l.y=this.baseY-5-l.height,this.host.collisionInput(l.x,l.y,l.width,l.height,"bR")&&(this.hostDied=!0,this.host.clearPath()),(l.x<=-l.width||l.x>=this.width)&&this.boxes.splice(u,1);o=null}return this.host.action(),this},touchStart:function(e,n){return this.host.endPath()?(t.comm.collision(e,n,1,1,this.x,this.baseY-this.height,this.width,this.height)&&this.host.setPath([[0,-20],[0,-20],[0,-20],[0,-10],[0,-10],[0,-10],[0,-5],[0,-5],[0,-5],[0,5],[0,5],[0,5],[0,10],[0,10],[0,10],[0,20],[0,20],[0,20]]),this):this}})},m=function(e){t.buttonLayout.clear().base().gameFlow.run(),f.died=!1,f.scenes=[],f.time=0,f.date=Date.now(),f.shine=null,f.module=e;for(var n=0;n<e;n++)f.scenes.push(new f.Scene(n))},p=function(){var s=e-480>>1;f.time>1e4&&(i(f.time),alert("强！你居然坚持了"+f.time/1e3+"秒！")),t.buttonLayout.clear().create({id:"return",value:"返回游戏主界面",bgColor:"",bgStroke:"",stroke:"",x:s+100,y:u+580,width:300,height:80,font:"36px 微软雅黑",imageId:"",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#AAA",dex:272,dey:0,deColor:"#CCC"}).base().gameFlow.zone();var a=t.localStorage.getItem("NotDieAnyoneBestTime"+f.module);null==a&&(a="0"),f.bestTime=parseInt(a),f.time>f.bestTime&&t.localStorage.setItem("NotDieAnyoneBestTime"+f.module,f.time.toString()),n(f.module,f.time*(f.module-1))}}}})),require.config({baseUrl:"js"}),require(["lib/link","index"],(function(t,e){t.init(window.innerWidth,window.innerHeight).pushImage([{id:"logo",src:"images/ygdbns.jpg"},{id:"btns1",src:"images/gdyx.png"}],(function(t,e,n){})).initAudio([{id:"1",src:"",preload:!0}]).loadingCallBack((function(t,e){})).main((function(){e.init()}))})),define("main",(function(){}));